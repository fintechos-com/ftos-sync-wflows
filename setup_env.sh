#!/bin/bash
set -e

# Ensure required environment variables are set
if [[ -z "$GH_TOKEN_MASTER" || -z "$ORG_MASTER" || -z "$TEMPLATE_REPO" ]]; then
  echo "Error: Required environment variables (GH_TOKEN_MASTER, ORG_MASTER, TEMPLATE_REPO) are not set. Exiting."
  exit 1
fi

# If GH_TOKEN_SLAVES is not set or empty, use GH_TOKEN_MASTER
if [[ -z "$GH_TOKEN_SLAVES" ]]; then
  echo "GH_TOKEN_SLAVES not provided, using GH_TOKEN_MASTER."
  export GH_TOKEN_SLAVES="$GH_TOKEN_MASTER"
  export ORG_SLAVES="$ORG_MASTER"
fi

# Convert EXCLUDED_REPOS to an array (comma-separated values)
IFS=',' read -r -a EXCLUDED_REPO_ARRAY <<< "$EXCLUDED_REPOS"

IFS=',' read -r -a IGNORED_FILES_ARRAY <<< "$IGNORE_YAML_FILES"

export GH_TOKEN_MASTER
export GH_TOKEN_SLAVES
export ORG_MASTER
export ORG_SLAVES
export TEMPLATE_REPO
export PAGE=${PAGE:-1}  # Default to 1 if PAGE is not provided
export EXCLUDED_REPO_ARRAY
export IGNORED_FILES_ARRAY

# âœ… Log Environment Variables (Debugging)
echo "ðŸ”¹ GH_TOKEN_MASTER: [SET]"
echo "ðŸ”¹ GH_TOKEN_SLAVES: [SET]"
echo "ðŸ”¹ ORG_MASTER: $ORG_MASTER"
echo "ðŸ”¹ ORG_SLAVES: $ORG_SLAVES"
echo "ðŸ”¹ TEMPLATE_REPO: $TEMPLATE_REPO"
echo "ðŸ”¹ PAGE: $PAGE"
echo "ðŸ”¹ EXCLUDED_REPOS: ${EXCLUDED_REPO_ARRAY[*]}"
echo "ðŸ”¹ IGNORED_FILES: ${IGNORED_FILES_ARRAY[*]}"